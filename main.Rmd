---
title: "main"
author: "Davide Capone"
date: "22/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("dplyr")
library("ggplot2")
library("tidyverse")
library("tidytext")

```

```{r}
# Import original dataset
dataset <- read.csv("./datasets/tcc_ceds_music.csv")

# Tidying
tidy_dataset <- dataset %>% 
  select(artist_name, 
         track_name, 
         release_date, 
         genre, 
         lyrics, 
         len)

# add coloumn 'decade' to perform analysis
tidy_dataset <- tidy_dataset %>% 
  mutate(decade =
    case_when(
      2010 <= release_date ~ "10-20",
      2000 <= release_date ~ "00-10",
      1990 <= release_date ~ "90-00",
      1980 <= release_date ~ "80-90",
      1970 <= release_date ~ "70-80",
      1960 <= release_date ~ "60-70",
      release_date < 1960 ~ "50-60"
    )
  )

# ... save
write.csv(tidy_dataset, "./datasets/tcc_ceds_music_tidy.csv", row.names = TRUE)

```

```{r}
# Import tidy dataset
tidy_dataset <- data.frame(read.csv("./datasets/tcc_ceds_music_tidy.csv"))
  
```

```{r}
# - Sentiment Analysis

from_1950_60 <- tidy_dataset %>% 
  select(lyrics) %>% 
  filter(tidy_dataset$decade == "50-60")

from_1950_60 <- tibble(text = from_1950_60)

# unnest_tokens, dataframe to vector
from_1950_60 <- from_1950_60 %>% 
  mutate_all(as.character) %>% 
  unnest_tokens(word, text)

from_1950_60 %>%
  count(word, sort = TRUE) 

from_1950_60 %>%
  count(word, sort = TRUE) %>%
  filter(n >= 1000000) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(n, word))

nrc_joy <- get_sentiments("nrc") %>% 
  filter(sentiment == "joy")

from_1950_60 %>%
  inner_join(nrc_joy) %>%
  count(word, sort = TRUE) %>%
  filter(n >= 249560) %>%
  ggplot(aes(n, word)) +
  geom_col() +
  labs(y = NULL)
```


