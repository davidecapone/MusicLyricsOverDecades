---
title: "main"
author: "Davide Capone"
date: "22/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("dplyr")
library("ggplot2")
library("tidyverse")
library("tidytext")

```

```{r}
# Import original dataset
dataset <- read.csv("./datasets/tcc_ceds_music.csv")

# Tidying
tidy_dataset <- dataset %>% 
  select(artist_name, 
         track_name, 
         release_date, 
         genre, 
         lyrics, 
         len)

# add coloumn 'decade' to perform analysis
tidy_dataset <- tidy_dataset %>% 
  mutate(decade =
    case_when(
      2010 <= release_date ~ "10-20",
      2000 <= release_date ~ "00-10",
      1990 <= release_date ~ "90-00",
      1980 <= release_date ~ "80-90",
      1970 <= release_date ~ "70-80",
      1960 <= release_date ~ "60-70",
      release_date < 1960 ~ "50-60"
    )
  )

# ... save
write.csv(tidy_dataset, "./datasets/tcc_ceds_music_tidy.csv", row.names = TRUE)

```

```{r}
# Import tidy dataset
tidy_dataset <- data.frame(read.csv("./datasets/tcc_ceds_music_tidy.csv"))
  
```

```{r}
# - Sentiment Analysis
# text --> unnest_tokens --> tidy text --> summarized text --> ggplot (visualization)

# One token per row: in this case token is a single word

text_df <- tidy_dataset %>% 
  select(lyrics) %>% 
  filter(tidy_dataset$decade == "50-60")

tokens <- text_df %>%
  unnest_tokens(unigram, lyrics) %>% 
  count(unigram, sort = TRUE)

tokens <- text_df %>%
  unnest_tokens(bigram, lyrics, token = "ngrams", n = 2) %>% 
  count(bigram, sort = TRUE)

tokens <- text_df %>%
  unnest_tokens(trigram, lyrics, token = "ngrams", n = 3) %>% 
  count(trigram, sort = TRUE)

saveUnigramCSV(tidy_dataset, "50-60", 1);


saveNgramCSV <- function (dataset, decade, n) {
  dataset <- dataset %>% 
    select(lyrics) %>% 
    filter(dataset$decade == "50-60")
  
  tokens <- dataset %>%
    unnest_tokens(token, lyrics, token = "ngrams", n = 1) %>% 
    count(token, sort = TRUE)
  
  write.csv(tokens, "./datasets/tokens/50_60.csv", row.names = TRUE)
}


```


